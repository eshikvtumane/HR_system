/**
 * DaData.ru Suggestions jQuery plugin, version 4.10.7
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(b,c){var d=this;d.element=b,d.el=a(b),d.suggestions=[],d.badQueries=[],d.selectedIndex=-1,d.currentValue=d.element.value,d.intervalId=0,d.cachedResponse={},d.enrichmentCache={},d.currentRequest=null,d.inputPhase=a.Deferred(),d.dataPhase=a.Deferred(),d.onChangeTimeout=null,d.$wrapper=null,d.options=a.extend({},k,c),d.classes={hint:"suggestions-hint",mobile:"suggestions-mobile",nowrap:"suggestions-nowrap",selected:"suggestions-selected",suggestion:"suggestions-suggestion",subtext:"suggestions-subtext",subtext_inline:"suggestions-subtext suggestions-subtext_inline",subtext_delimiter:"suggestions-subtext-delimiter",subtext_label:"suggestions-subtext suggestions-subtext_label",removeConstraint:"suggestions-remove"},d.selection=null,d.$viewport=a(window),d.type=null,d.initialize(),d.setOptions(c)}var c={ENTER:13,ESC:27,TAB:9,RETURN:13,SPACE:32,UP:38,DOWN:40},d={},e=".suggestions",f="suggestions",g="\\s\"'~\\*\\.,:\\|\\[\\]\\(\\)\\{\\}<>№",h=new RegExp("["+g+"]+","g"),i="\\-\\+\\/\\\\\\?!@#$%^&",j=new RegExp("["+i+"]+","g"),k={autoSelectFirst:!1,serviceUrl:null,onSearchStart:a.noop,onSearchComplete:a.noop,onSearchError:a.noop,onSelect:null,onSelectNothing:null,onInvalidateSelection:null,minChars:1,width:"auto",deferRequestBy:100,params:{},paramName:"query",formatResult:null,formatSelected:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!0,preventBadQueries:!1,hint:"Выберите вариант или продолжите ввод",type:null,count:5,$helpers:null,headers:null,scrollOnFocus:!0,mobileWidth:980},l={chains:{},on:function(a,b){return this.get(a).push(b),this},get:function(a){var b=this.chains;return b[a]||(b[a]=[])}},m=function(){var b=0;return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},escapeHtml:function(b){var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return b&&a.each(c,function(a,c){b=b.replace(new RegExp(a,"g"),c)}),b},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},fixURLProtocol:function(b){return a.support.cors?b:b.replace(/^https?:/,location.protocol)},addUrlParams:function(b,c){return b+(/\?/.test(b)?"&":"?")+a.param(c)},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)},compact:function(b){return a.grep(b,function(a){return!!a})},delay:function(a,b){return setTimeout(a,b||0)},uniqueId:function(a){return(a||"")+ ++b},slice:function(a,b){return Array.prototype.slice.call(a,b)},areSame:function c(b,d){var e=!0;return typeof b!=typeof d?!1:"object"==typeof b&&null!=b&&null!=d?(a.each(b,function(a,b){return e=c(b,d[a])}),e):b===d},arrayMinus:function(b,c){return c?a.grep(b,function(b){return-1===a.inArray(b,c)}):b},getWords:function(a,b){a=a.replace(/(\d+)([а-яА-ЯёЁ]{2,})/g,"$1 $2").replace(/([а-яА-ЯёЁ]+)(\d+)/g,"$1 $2");var c=this.compact(a.split(h)),d=c.pop(),e=this.arrayMinus(c,b);return e.push(d),e},normalize:function(a,b){var c=this;return c.getWords(a,b).join(" ")},stringEncloses:function(a,b){return a.length>b.length&&-1!==a.indexOf(b)},fieldsNotEmpty:function(b,c){if(!a.isPlainObject(b))return!1;var d=!0;return a.each(c,function(a,c){return d=!!b[c]}),d},getDeepValue:function d(a,b){var c=b.split("."),e=c.shift();return a&&(c.length?d(a[e],c.join(".")):a[e])},reWordExtractor:function(){return new RegExp("([^"+g+"]*)(["+g+"]*)","g")},formatToken:function(a){return a&&a.toLowerCase().replace(/[ёЁ]/g,"е")},withSubTokens:function(b){var c=[];return a.each(b,function(a,b){var d=b.split(j);c.push(b),d.length>1&&(c=c.concat(m.compact(d)))}),c}}}(),n=function(){function b(b){if(0===b.length)return!1;if(1===b.length)return!0;var c=b[0].value,d=a.grep(b,function(a){return 0===a.value.indexOf(c)},!0);return 0===d.length}return{matchByNormalizedQuery:function(b,c){var d=b.toLowerCase(),e=this.STOPWORDS,f=m.normalize(d,e),g=[];return a.each(c,function(a,b){var c=b.value.toLowerCase();return m.stringEncloses(d,c)?!1:c.indexOf(f)>0?!1:void(f===m.normalize(c,e)&&g.push(a))}),1==g.length?g[0]:-1},matchByWords:function(c,d){var e=this.STOPWORDS,f=c.toLowerCase(),g=m.getWords(f,e),h=-1;return b(d)&&a.each(d,function(a,b){var c=b.value.toLowerCase();if(m.stringEncloses(f,c))return!1;var d=m.getWords(c,e);return 0===m.arrayMinus(g,d).length?(h=a,!1):void 0}),h},matchByFields:function(b,c){var d=this.STOPWORDS,e=this.fieldsStopwords,f=m.withSubTokens(m.getWords(b.toLowerCase(),d)),g=[];return a.each(c,function(b,c){var d=[];e&&a.each(e,function(a,b){var e=m.getDeepValue(c.data,a),f=e&&m.withSubTokens(m.getWords(e.toLowerCase(),b));f&&f.length&&(d=d.concat(f))}),0===m.arrayMinus(f,d).length&&g.push(b)}),1==g.length?g[0]:-1}}}();!function(){function b(a,b){var c=a.data&&a.data[b];return c&&new RegExp("^"+m.escapeRegExChars(c)+"(["+g+"]|$)","i").test(a.value)}var c=["ао","аобл","дом","респ","а/я","аал","автодорога","аллея","арбан","аул","б-р","берег","бугор","вал","вл","волость","въезд","высел","г","городок","гск","д","двлд","днп","дор","дп","ж/д_будка","ж/д_казарм","ж/д_оп","ж/д_платф","ж/д_пост","ж/д_рзд","ж/д_ст","жилзона","жилрайон","жт","заезд","заимка","зона","к","казарма","канал","кв","кв-л","км","кольцо","комн","кордон","коса","кп","край","линия","лпх","м","массив","местность","мкр","мост","н/п","наб","нп","обл","округ","остров","оф","п","п/о","п/р","п/ст","парк","пгт","пер","переезд","пл","пл-ка","платф","погост","полустанок","починок","пр-кт","проезд","промзона","просек","просека","проселок","проток","протока","проулок","р-н","рзд","россия","рп","ряды","с","с/а","с/мо","с/о","с/п","с/с","сад","сквер","сл","снт","спуск","ст","ст-ца","стр","тер","тракт","туп","у","ул","уч-к","ф/х","ферма","х","ш","бульвар","владение","выселки","гаражно-строительный","город","деревня","домовладение","дорога","квартал","километр","комната","корпус","литер","леспромхоз","местечко","микрорайон","набережная","область","переулок","платформа","площадка","площадь","поселение","поселок","проспект","разъезд","район","республика","село","сельсовет","слобода","сооружение","станица","станция","строение","территория","тупик","улица","улус","участок","хутор","шоссе"];d.NAME={matchers:[n.matchByNormalizedQuery,n.matchByWords],isDataComplete:function(c){var d,e=this,f=e.options.params,g=c.data;return f&&f.parts?d=a.map(f.parts,function(a){return a.toLowerCase()}):(d=["surname","name"],b(c,"surname")&&d.push("patronymic")),m.fieldsNotEmpty(g,d)},composeValue:function(a){return m.compact([a.surname,a.name,a.patronymic]).join(" ")},urlSuffix:"fio",fieldNames:{surname:"фамилия",name:"имя",patronymic:"отчество"},alwaysContinueSelecting:!0},d.ADDRESS={STOPWORDS:c,matchers:[n.matchByNormalizedQuery,n.matchByWords],geoEnabled:!0,enrichmentEnabled:!0,boundsAvailable:["region","area","city","settlement","street","house"],boundsFields:{region:["region","region_type","region_type_full","region_with_type"],area:["area","area_type","area_type_full","area_with_type"],city:["city","city_type","city_type_full","city_with_type"],settlement:["settlement","settlement_type","settlement_type_full","settlement_with_type"],street:["street","street_type","street_type_full","street_with_type"],house:["house","house_type","house_type_full","block","block_type"]},isDataComplete:function(b){var c=[this.bounds.to||"flat"],d=b.data;return!a.isPlainObject(d)||m.fieldsNotEmpty(d,c)},composeValue:function(a){return m.compact([a.region_with_type||m.compact([a.region,a.region_type]).join(" "),a.area_with_type||m.compact([a.area_type,a.area]).join(" "),a.city_with_type||m.compact([a.city_type,a.city]).join(" "),a.settlement_with_type||m.compact([a.settlement_type,a.settlement]).join(" "),a.street_with_type||m.compact([a.street_type,a.street]).join(" "),m.compact([a.house_type,a.house,a.block_type,a.block]).join(" "),m.compact([a.flat_type,a.flat]).join(" "),a.postal_box?"а/я "+a.postal_box:null]).join(", ")},urlSuffix:"address"},d.PARTY={fieldsStopwords:{"address.value":c,inn:null,ogrn:null,"name.full":null,"name.short":null,"name.latin":null,"opf.full":null,"opf.short":null},matchers:[n.matchByFields],isDataComplete:function(){return!0},urlSuffix:"party",formatResult:function(a,b,d,e){var f=this,h=f.type.formatResultInn.call(f,d,b),i=m.getDeepValue(d,"data.address.value");return f.isMobile&&((e||(e={})).maxLength=50),a=f.formatResult.call(f,a,b,d,e),i&&(i=i.replace(/^\d{6}( РОССИЯ)?, /i,""),i=f.isMobile?i.replace(new RegExp("^([^"+g+"]+["+g+"]+[^"+g+"]+).*"),"$1"):f.formatResult(i,b,d,{unformattableTokens:c})),(h||i)&&(a+='<div class="'+f.classes.subtext+'"><span class="'+f.classes.subtext_inline+'">'+(h||"")+"</span>"+(i||"")+"</div>"),a},innPartsLength:{LEGAL:[2,2,5,1],INDIVIDUAL:[2,2,6,2]},formatResultInn:function(b,c){var d,e,f=this,g=b.data&&b.data.inn,h=f.type.innPartsLength[b.data&&b.data.type],i=/\d/;return g?(e=f.formatResult(g,c,b),h&&(e=e.split(""),d=a.map(h,function(a){for(var b,c="";a&&(b=e.shift());)c+=b,i.test(b)&&a--;return c}),e=d.join('<span class="'+f.classes.subtext_delimiter+'"></span>')+e.join("")),e):void 0}},d.EMAIL={urlSuffix:"email",matchers:[n.matchByNormalizedQuery],isDataComplete:function(){return!0},isQueryRequestable:function(a){return this.options.suggest_local||a.indexOf("@")>=0}},a.extend(k,{suggest_local:!0})}();var o={suggest:{defaultParams:{type:m.getDefaultType(),dataType:"json",contentType:m.getDefaultContentType()},addTypeInUrl:!0},detectAddressByIp:{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!1}};b.utils=m,b.defaultOptions=k,b.version="4.10.7",a.Suggestions=b,b.prototype={initialize:function(){var a=this;a.element.setAttribute("autocomplete","off"),this.el.addClass("suggestions-input").css("box-sizing","border-box"),a.uniqueId=m.uniqueId("i"),a.createWrapper(),a.notify("initialize"),a.bindWindowEvents(),a.fixPosition()},dispose:function(){var a=this;a.notify("dispose"),a.el.removeData(f).removeClass("suggestions-input"),a.unbindWindowEvents(),a.removeWrapper(),a.el.trigger("suggestions-dispose")},notify:function(b){var c=this,d=m.slice(arguments,1);return a.map(l.get(b),function(a){return a.apply(c,d)})},createWrapper:function(){var b=this;b.$wrapper=a('<div class="suggestions-wrapper"/>'),b.el.after(b.$wrapper),b.$wrapper.add(b.options.$helpers).on("mousedown"+e,a.proxy(b.onMousedown,b))},removeWrapper:function(){var b=this;b.$wrapper.remove(),a(b.options.$helpers).off(e)},onMousedown:function(b){var c=this;b.preventDefault(),c.cancelBlur=!0,m.delay(function(){delete c.cancelBlur}),a(b.target).closest(".ui-menu-item").length||m.delay(function(){a(document).one("mousedown",function(b){var d=c.el.add(c.$wrapper).add(c.options.$helpers);d=d.filter(function(){return this===b.target||a.contains(this,b.target)}),d.length||c.hide()})})},bindWindowEvents:function(){var b=this;b.$viewport.on("resize"+e+b.uniqueId,a.proxy(b.fixPosition,b))},unbindWindowEvents:function(){this.$viewport.off("resize"+e+this.uniqueId)},scrollToTop:function(){var b=this,c=b.options.scrollOnFocus;c===!0&&(c=b.el),c instanceof a&&c.length>0&&a("body,html").animate({scrollTop:c.offset().top},"fast")},setOptions:function(b){var c=this;if(a.extend(c.options,b),c.type=d[c.options.type],!c.type)throw c.disable(),"`type` option is incorrect! Must be one of: "+a.map(d,function(a,b){return'"'+b+'"'}).join(", ");c.notify("setOptions")},fixPosition:function(){var b,c,d=this,e={};d.isMobile=d.$viewport.width()<=d.options.mobileWidth,d.notify("resetPosition"),d.el.css("paddingLeft",""),d.el.css("paddingRight",""),e.paddingLeft=parseFloat(d.el.css("paddingLeft")),e.paddingRight=parseFloat(d.el.css("paddingRight")),a.extend(e,d.el.offset()),e.borderTop="none"==d.el.css("border-top-style")?0:parseFloat(d.el.css("border-top-width")),e.borderLeft="none"==d.el.css("border-left-style")?0:parseFloat(d.el.css("border-left-width")),e.innerHeight=d.el.innerHeight(),e.innerWidth=d.el.innerWidth(),e.outerHeight=d.el.outerHeight(),e.componentsLeft=0,e.componentsRight=0,b=d.$wrapper.offset(),c={top:e.top-b.top,left:e.left-b.left},d.notify("fixPosition",c,e),e.componentsLeft>e.paddingLeft&&d.el.css("paddingLeft",e.componentsLeft+"px"),e.componentsRight>e.paddingRight&&d.el.css("paddingRight",e.componentsRight+"px")},clearCache:function(){this.cachedResponse={},this.enrichmentCache={},this.badQueries=[]},clear:function(){var a=this;a.clearCache(),a.currentValue="",a.selection=null,a.hide(),a.suggestions=[],a.el.val(""),a.el.trigger("suggestions-clear"),a.notify("clear")},disable:function(){var a=this;a.disabled=!0,a.abortRequest(),a.hide()},enable:function(){this.disabled=!1},update:function(){var a=this,b=a.el.val();this.isQueryRequestable(b)?a.updateSuggestions(b):a.hide()},setSuggestion:function(b){var c,d=this;a.isPlainObject(b)&&(c=b.value||"",d.currentValue=c,d.el.val(c),d.selection=b,d.suggestions=[b],d.abortRequest())},getAjaxParams:function(c,d){var e=this,f=a.trim(e.options.token),g=e.options.serviceUrl,h=o[c],i=a.extend({},h.defaultParams),j={};return/\/$/.test(g)||(g+="/"),g+=c,h.addTypeInUrl&&(g+="/"+e.type.urlSuffix),g=m.fixURLProtocol(g),a.support.cors?(f&&(j.Authorization="Token "+f),j["X-Version"]=b.version,i.headers||(i.headers={}),a.extend(i.headers,e.options.headers,j)):(f&&(j.token=f),j.version=b.version,g=m.addUrlParams(g,j)),i.url=g,a.extend(i,d)},isQueryRequestable:function(a){var b,c=this;return b=a.length>=c.options.minChars,c.type.isQueryRequestable&&(b=b&&c.type.isQueryRequestable.call(c,a)),b},constructRequestParams:function(b,c){var d=this,e=d.options,f=a.isFunction(e.params)?e.params.call(d.element,b):a.extend({},e.params);return d.type.constructRequestParams&&a.extend(f,d.type.constructRequestParams.call(d)),a.each(d.notify("requestParams"),function(b,c){a.extend(f,c)}),f[e.paramName]=b,a.isNumeric(e.count)&&e.count>0&&(f.count=e.count),a.extend(f,c)},updateSuggestions:function(a){var b=this;b.dataPhase=b.getSuggestions(a).done(function(c){b.assignSuggestions(c,a)})},getSuggestions:function(b,c,d){var e,f=this,g=f.options,h=d&&d.noCallbacks,i=d&&d.useEnrichmentCache,j=f.constructRequestParams(b,c),k=a.param(j||{}),l=a.Deferred();return e=f.cachedResponse[k],e&&a.isArray(e.suggestions)?l.resolve(e.suggestions):f.isBadQuery(b)?l.reject():h||g.onSearchStart.call(f.element,j)!==!1?f.doGetSuggestions(j).done(function(a){f.processResponse(a)&&b==f.currentValue?(g.noCache||(i?f.enrichmentCache[b]=a.suggestions[0]:(f.enrichResponse(a,b),f.cachedResponse[k]=a,g.preventBadQueries&&0===a.suggestions.length&&f.badQueries.push(b))),l.resolve(a.suggestions)):l.reject(),h||g.onSearchComplete.call(f.element,b,a.suggestions)}).fail(function(a,c,d){l.reject(),h||g.onSearchError.call(f.element,b,a,c,d)}):l.reject(),l},doGetSuggestions:function(b){var c=this,d=a.ajax(c.getAjaxParams("suggest",{data:m.serialize(b)}));return c.abortRequest(),c.currentRequest=d,c.notify("request"),d.always(function(){c.currentRequest=null,c.currentRequestIsEnrich=!1,c.notify("request")}),d},isBadQuery:function(b){if(!this.options.preventBadQueries)return!1;var c=!1;return a.each(this.badQueries,function(a,d){return!(c=0===b.indexOf(d))}),c},abortRequest:function(){var a=this;a.currentRequest&&a.currentRequest.abort()},processResponse:function(b){var c=this;return b&&a.isArray(b.suggestions)?(c.verifySuggestionsFormat(b.suggestions),c.setUnrestrictedValues(b.suggestions),!0):!1},verifySuggestionsFormat:function(b){"string"==typeof b[0]&&a.each(b,function(a,c){b[a]={value:c,data:null}})},assignSuggestions:function(a,b){var c=this;c.suggestions=a,c.notify("assignSuggestions",b)},shouldRestrictValues:function(){var a=this;return a.options.restrict_value&&a.constraints&&1==Object.keys(a.constraints).length},setUnrestrictedValues:function(b){var c=this,d=c.shouldRestrictValues(),e=c.getFirstConstraintLabel();a.each(b,function(a,b){b.unrestricted_value=d?e+", "+b.value:b.value})},areSuggestionsSame:function(a,b){return a&&b&&a.value===b.value&&m.areSame(a.data,b.data)},findSuggestionIndex:function(b){var c=this,d=-1;return""!==a.trim(b)&&a.each(c.type.matchers,function(a,e){return d=e.call(c.type,b,c.suggestions),-1===d}),d}},function(){var d={bindElementEvents:function(){var b=this;b.el.on("keydown"+e,a.proxy(b.onElementKeyDown,b)),b.el.on(["keyup"+e,"cut"+e,"paste"+e,"input"+e].join(" "),a.proxy(b.onElementKeyUp,b)),b.el.on("blur"+e,a.proxy(b.onElementBlur,b)),b.el.on("focus"+e,a.proxy(b.onElementFocus,b))},unbindElementEvents:function(){this.el.off(e)},onElementBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:(a.selectCurrentValue({trim:!0,noSpace:!0}).done(function(){a.hide()}),void(a.currentRequestIsEnrich||a.abortRequest()))},onElementFocus:function(){var b=this;b.cancelFocus||m.delay(a.proxy(b.completeOnFocus,b)),b.cancelFocus=!1},onElementKeyDown:function(a){var b=this;if(!b.disabled)if(b.visible){switch(a.which){case c.ESC:b.el.val(b.currentValue),b.hide(),b.abortRequest();break;case c.TAB:if(b.options.tabDisabled===!1)return;break;case c.RETURN:b.selectCurrentValue({trim:!0});break;case c.SPACE:return void(b.options.triggerSelectOnSpace&&b.isCursorAtEnd()&&(a.preventDefault(),b.selectCurrentValue({continueSelecting:!0,dontEnrich:!0}).done(function(a){-1===a&&(b.currentValue+=" ",b.el.val(b.currentValue),b.update())})));case c.UP:b.moveUp();break;case c.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}else switch(a.which){case c.DOWN:b.suggest();break;case c.RETURN:b.triggerOnSelectNothing()}},onElementKeyUp:function(b){var d=this;if(!d.disabled){switch(b.which){case c.UP:case c.DOWN:case c.ENTER:return}clearTimeout(d.onChangeTimeout),d.inputPhase.reject(),d.currentValue!==d.el.val()&&(d.inputPhase=a.Deferred().done(a.proxy(d.onValueChange,d)),d.options.deferRequestBy>0?d.onChangeTimeout=m.delay(function(){d.inputPhase.resolve()},d.options.deferRequestBy):d.inputPhase.resolve())}},onValueChange:function(){var a=this,b=a.el.val();a.selection&&(a.trigger("InvalidateSelection",a.selection),a.selection=null),a.currentValue=b,a.selectedIndex=-1,a.update(),a.notify("valueChange")},completeOnFocus:function(){var a=this;document.activeElement===a.element&&(a.fixPosition(),a.update(),a.isMobile&&(a.setCursorAtEnd(),a.scrollToTop()))},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},setCursorAtEnd:function(){var a=this.element;a.selectionEnd=a.selectionStart=a.value.length,a.scrollLeft=a.scrollWidth}};a.extend(b.prototype,d),l.on("initialize",d.bindElementEvents).on("dispose",d.unbindElementEvents)}(),function(){var c={},d={checkToken:function(){function b(){d.checkToken()}var d=this,e=a.trim(d.options.token),f=c[e];if(e)if(f&&a.isFunction(f.promise))switch(f.state()){case"resolved":d.enable();break;case"rejected":d.disable();break;default:f.always(b)}else(c[e]=a.ajax(d.getAjaxParams("suggest"))).always(b)}};b.resetTokens=function(){c={}},a.extend(b.prototype,d),l.on("setOptions",d.checkToken)}(),function(){function c(){d=null,b.defaultOptions.geoLocation=e}if("GET"!=m.getDefaultType()){var d,e=!0,f={checkLocation:function(){var b=this;b.type.geoEnabled&&b.options.geoLocation&&(b.geoLocation=a.Deferred(),a.isPlainObject(b.options.geoLocation)?b.geoLocation.resolve(b.options.geoLocation):(d||(d=a.ajax(b.getAjaxParams("detectAddressByIp"))),d.done(function(a){var c=a&&a.location&&a.location.data;c&&c.kladr_id?b.geoLocation.resolve(c):b.geoLocation.reject()}).fail(function(){b.geoLocation.reject()})))},getGeoLocation:function(){return this.geoLocation},constructParams:function(){var b=this,c={};return b.geoLocation&&a.isFunction(b.geoLocation.promise)&&"resolved"==b.geoLocation.state()&&b.geoLocation.done(function(a){c.locations_boost=[a]}),c}};a.extend(k,{geoLocation:e}),a.extend(b,{resetLocation:c}),a.extend(b.prototype,{getGeoLocation:f.getGeoLocation}),l.on("setOptions",f.checkLocation).on("requestParams",f.constructParams)}}(),function(){var c={enrichSuggestion:function(b,c){var d=this,e=a.trim(d.options.token),f=a.Deferred();return!d.options.useDadata||!d.type.enrichmentEnabled||!e||c&&c.dontEnrich?f.resolve(b):b.data&&null!=b.data.qc?f.resolve(b):(d.disableDropdown(),d.currentValue=b.value,d.currentRequestIsEnrich=!0,d.getSuggestions(b.value,{count:1},{noCallbacks:!0,useEnrichmentCache:!0}).always(function(){d.enableDropdown()}).done(function(a){var c=a&&a[0];f.resolve(c||b,!!c)}).fail(function(){f.resolve(b)}),f)},enrichResponse:function(b,c){var d=this,e=d.enrichmentCache[c];e&&a.each(b.suggestions,function(a,d){return d.value===c?(b.suggestions[a]=e,!1):void 0})}};a.extend(k,{useDadata:!0}),a.extend(b.prototype,c)}(),function(){function c(b){return a.map(b,function(a){var b=m.escapeHtml(a.text);return b&&a.matched&&(b="<strong>"+b+"</strong>"),b}).join("")}function d(b,c){var d=b.split(", ");return 1===d.length?b:a.map(d,function(a){return'<span class="'+c+'">'+a+"</span>"}).join(", ")}function f(b,c){var d=!1;return a.each(b,function(a,b){return d=b.value==c.value&&b!=c,d?!1:void 0}),d}var g={createContainer:function(){var b=this,c="."+b.classes.suggestion,d=b.options,f=a("<div/>").addClass(d.containerClass).css({position:"absolute",display:"none"});b.$container=f,b.$wrapper.append(f),"auto"!==d.width&&f.width(d.width),f.on("click"+e,c,a.proxy(b.onSuggestionClick,b))},onSuggestionClick:function(b){var c,d=this,e=a(b.target);if(!d.dropdownDisabled){for(;e.length&&!(c=e.attr("data-index"));)e=e.closest("."+d.classes.suggestion);c&&!isNaN(c)&&d.select(+c)}d.cancelFocus=!0,d.el.focus()},setDropdownPosition:function(a,b){var c=this;c.$container.toggleClass(c.classes.mobile,c.isMobile).css(c.isMobile?{left:a.left-b.left+"px",top:a.top+b.outerHeight+"px",width:c.$viewport.width()+"px"}:{left:a.left+"px",top:a.top+b.borderTop+b.innerHeight+"px",width:("auto"===c.options.width?c.el.outerWidth():c.options.width)+"px"}),c.containerItemsPadding=b.left+b.borderLeft+b.paddingLeft},setItemsPositions:function(){var a=this,b=a.getSuggestionsItems();b.css("paddingLeft",a.isMobile?a.containerItemsPadding+"px":"")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(a){this.dropdownDisabled=!a,this.$container.attr("disabled",!a)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var b=this;return b.suggestions.length>1||1===b.suggestions.length&&(!b.selection||a.trim(b.suggestions[0].value)!=a.trim(b.selection.value))},suggest:function(){if(!this.hasSuggestionsToChoose())return void this.hide();var b=this,c=b.options,d=c.formatResult||b.type.formatResult||b.formatResult,e=c.beforeRender,f=[];!b.isMobile&&c.hint&&b.suggestions.length&&f.push('<div class="'+b.classes.hint+'">'+c.hint+"</div>"),b.selectedIndex=-1,a.each(b.suggestions,function(a,c){var e=b.makeSuggestionLabel(b.suggestions,c);c==b.selection&&(b.selectedIndex=a),f.push('<div class="'+b.classes.suggestion+'" data-index="'+a+'">'+d.call(b,c.value,b.currentValue,c,{unformattableTokens:b.type.STOPWORDS})),e&&f.push('<span class="'+b.classes.subtext_label+'">'+m.escapeHtml(e)+"</span>"),f.push("</div>")}),b.$container.html(f.join("")),c.autoSelectFirst&&-1===b.selectedIndex&&(b.selectedIndex=0),-1!==b.selectedIndex&&b.getSuggestionsItems().eq(b.selectedIndex).addClass(b.classes.selected),a.isFunction(e)&&e.call(b.element,b.$container),b.$container.show(),b.visible=!0,b.setItemsPositions()},formatResult:function(b,e,f,g){var j,k,l,n,o,p,q=this,r=[],s=g&&g.unformattableTokens,t=g&&g.maxLength,u=m.reWordExtractor();for(j=m.formatToken(e).split(h),j=m.arrayMinus(m.withSubTokens(j),s),k=a.map(j,function(a){return new RegExp("^((.*)(["+i+"]+))?("+m.escapeRegExChars(a)+")([^"+i+"]*["+i+"]*)","i")});(l=u.exec(b))&&l[0];)r.push({text:l[1],formatted:m.formatToken(l[1]),matchable:!0}),l[2]&&r.push({text:l[2]});for(n=0;n<r.length;n++)o=r[n],o.matchable&&!o.matched&&-1===a.inArray(o.formatted,s)&&a.each(k,function(a,b){var c,d=b.exec(o.formatted),e=n+1;return d?(d={before:d[1]||"",beforeText:d[2]||"",beforeDelimiter:d[3]||"",text:d[4]||"",after:d[5]||""},d.before&&(r.splice(n,0,{text:o.text.substr(0,d.beforeText.length),formatted:d.beforeText,matchable:!0},{text:d.beforeDelimiter}),e+=2,c=d.before.length,o.text=o.text.substr(c),o.formatted=o.formatted.substr(c),n--),c=d.text.length+d.after.length,o.formatted.length>c&&(r.splice(e,0,{text:o.text.substr(c),formatted:o.formatted.substr(c),matchable:!0}),o.text=o.text.substr(0,c),o.formatted=o.formatted.substr(0,c)),d.after&&(c=d.text.length,r.splice(e,0,{text:o.text.substr(c),formatted:o.formatted.substr(c)}),o.text=o.text.substr(0,c),o.formatted=o.formatted.substr(0,c)),o.matched=!0,!1):void 0});if(t){for(n=0;n<r.length&&t>=0;n++)o=r[n],t-=o.text.length,0>t&&(o.text=o.text.substr(0,o.text.length+t)+"...");r.length=n}return p=c(r),d(p,q.classes.nowrap)},makeSuggestionLabel:function(b,c){var d,e,g=this,h=g.type.fieldNames,i={},j=m.reWordExtractor(),k=[];if(h&&f(b,c)&&c.data&&(a.each(h,function(a){var b=c.data[a];b&&(i[a]=m.formatToken(b))}),!a.isEmptyObject(i))){for(;(d=j.exec(m.formatToken(c.value)))&&(e=d[1]);)a.each(i,function(a,b){return b==e?(k.push(h[a]),delete i[a],!1):void 0});if(k.length)return k.join(", ")}},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide().empty()},activate:function(a){var b,c,d=this,e=d.classes.selected;return!d.dropdownDisabled&&(c=d.getSuggestionsItems(),c.removeClass(e),d.selectedIndex=a,-1!==d.selectedIndex&&c.length>d.selectedIndex)?(b=c.eq(d.selectedIndex),b.addClass(e),b):null},deactivate:function(a){var b=this;b.dropdownDisabled||(b.selectedIndex=-1,b.getSuggestionsItems().removeClass(b.classes.selected),a&&b.el.val(b.currentValue))},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=e.$container.scrollTop();f&&f.length&&(b=f.position().top,0>b?e.$container.scrollTop(g+b):(c=b+f.outerHeight(),d=e.$container.innerHeight(),c>d&&e.$container.scrollTop(g-d+c)),e.el.val(e.suggestions[a].value))}};a.extend(b.prototype,g),l.on("initialize",g.createContainer).on("fixPosition",g.setDropdownPosition).on("fixPosition",g.setItemsPositions).on("assignSuggestions",g.suggest)}(),function(){var b="addon",c=50,d=1e3,e={addon:null},f={NONE:"none",SPINNER:"spinner",CLEAR:"clear"},g=function(b){var c=this,d=a('<span class="suggestions-addon"/>');c.owner=b,c.$el=d,c.type=f.NONE,c.visible=!1,c.initialPadding=null,d.on("click",a.proxy(c,"onClick"))};g.prototype={checkType:function(){var b=this,c=b.owner.options.addon,d=!1;a.each(f,function(a,b){return d=b==c,d?!1:void 0}),d||(c=b.owner.isMobile?f.CLEAR:f.SPINNER),c!=b.type&&(b.type=c,b.$el.attr("data-addon-type",c),b.toggle(!0))},toggle:function(a){var b,c=this;switch(c.type){case f.CLEAR:b=!!c.owner.currentValue;break;case f.SPINNER:b=!!c.owner.currentRequest;break;default:b=!1}b!=c.visible&&(c.visible=b,b?c.show(a):c.hide(a))},show:function(a){var b=this,d={opacity:1};a?(b.$el.show().css(d),b.showBackground(!0)):b.$el.stop(!0,!0).delay(c).queue(function(){b.$el.show(),b.showBackground(),b.$el.dequeue()}).animate(d,"fast")},hide:function(a){var b=this,c={opacity:0};a&&b.$el.hide().css(c),b.$el.stop(!0).animate(c,{duration:"fast",complete:function(){b.$el.hide(),b.hideBackground()}})},fixPosition:function(a,b){var c=this,d=b.innerHeight;c.checkType(),c.$el.css({left:a.left+b.borderLeft+b.innerWidth-d+"px",top:a.top+b.borderTop+"px",height:d,width:d}),c.initialPadding=b.paddingRight,c.width=d,c.visible&&(b.componentsRight+=d)},showBackground:function(a){var c=this,d=c.owner.el,e={paddingRight:c.width};c.width>c.initialPadding&&(c.stopBackground(),a?d.css(e):d.animate(e,{duration:"fast",queue:b}).dequeue(b))},hideBackground:function(a){var c=this,e=c.owner.el,f={paddingRight:c.initialPadding};c.width>c.initialPadding&&(c.stopBackground(!0),a?e.css(f):e.delay(d,b).animate(f,{duration:"fast",queue:b}).dequeue(b))},stopBackground:function(a){this.owner.el.stop(b,!0,a)},onClick:function(){var a=this;a.type==f.CLEAR&&a.owner.clear()}};var h={createAddon:function(){var a=this,b=new g(a);a.$wrapper.append(b.$el),a.addon=b},fixAddonPosition:function(a,b){this.addon.fixPosition(a,b)},checkAddonType:function(){this.addon.checkType()},checkAddonVisibility:function(){this.addon.toggle()},stopBackground:function(){this.addon.stopBackground()}};a.extend(k,e),l.on("initialize",h.createAddon).on("setOptions",h.checkAddonType).on("fixPosition",h.fixAddonPosition).on("clear",h.checkAddonVisibility).on("valueChange",h.checkAddonVisibility).on("request",h.checkAddonVisibility).on("resetPosition",h.stopBackground)}(),function(){function c(b){var c={};return a.isPlainObject(b)&&a.each(b,function(a,b){b&&f.indexOf(a)>=0&&(c[a]=b)}),a.isEmptyObject(c)?void 0:c.kladr_id?{kladr_id:c.kladr_id}:c}function d(b,c){var d=!0,e=c.selection;return e&&e.data&&c.bounds?(a.each(c.bounds.all,function(a,c){return d=e.data[c]===b.data[c]}),d):void 0}var e={constraints:null,restrict_value:!1},f=["kladr_id","postal_code","region","area","city","settlement","street"],g={createConstraints:function(){var b=this;b.constraints={},b.$constraints=a('<ul class="suggestions-constraints"/>'),b.$wrapper.append(b.$constraints),b.$constraints.on("click","."+b.classes.removeConstraint,a.proxy(b.onConstraintRemoveClick,b))},setConstraintsPosition:function(a,b){var c=this;c.$constraints.css({left:a.left+b.borderLeft+b.paddingLeft+"px",top:a.top+b.borderTop+Math.round((b.innerHeight-c.$constraints.height())/2)+"px"}),b.componentsLeft+=c.$constraints.outerWidth(!0)+b.paddingLeft},onConstraintRemoveClick:function(b){var c=this,d=a(b.target).closest("li"),e=d.attr("data-constraint-id");delete c.constraints[e],c.update(),d.fadeOut("fast",function(){c.removeConstraint(e)})},setupConstraints:function(){var b,c=this,d=c.options.constraints;return d?void(d instanceof a||"string"==typeof d||"number"==typeof d.nodeType?(b=a(d),b.is(c.constraints)||(c.unbindFromParent(),b.is(c.el)||(c.constraints=b,b.on(["suggestions-select."+c.uniqueId,"suggestions-invalidateselection."+c.uniqueId,"suggestions-clear."+c.uniqueId].join(" "),a.proxy(c.onParentSelectionChanged,c)),b.on("suggestions-dispose."+c.uniqueId,a.proxy(c.onParentDispose,c))))):(c._constraintsUpdating=!0,a.each(c.constraints,a.proxy(c.removeConstraint,c)),a.each(a.makeArray(d),function(a,b){c.addConstraint(b)}),c._constraintsUpdating=!1,c.fixPosition())):void c.unbindFromParent()},formatConstraint:function(b){var d,e=this;return b&&(b.locations||b.restrictions)?(d=a.makeArray(b.locations||b.restrictions),null==b.label&&e.type.composeValue&&(b.label=a.map(d,function(a){return e.type.composeValue(a)}).join(", ")),b.locations=[],a.each(d,function(a,d){var e=c(d);e&&b.locations.push(e)}),b.locations.length?b:null):void 0},addConstraint:function(b){var c,d,e=this;b=e.formatConstraint(b),b&&(d=m.uniqueId("c"),e.constraints[d]=b,b.label&&(c=a("<li/>").append(a("<span/>").text(b.label)).attr("data-constraint-id",d),b.deletable&&c.append(a('<span class="suggestions-remove"/>')),e.$constraints.append(c),e._constraintsUpdating||e.fixPosition()))},removeConstraint:function(a){var b=this;delete b.constraints[a],b.$constraints.children('[data-constraint-id="'+a+'"]').remove(),b._constraintsUpdating||b.fixPosition()},constructConstraintsParams:function(){for(var b,d,e=this,f=[],g=e.constraints,h={};g instanceof a&&(b=g.suggestions())&&!(d=m.getDeepValue(b,"selection.data"));)g=b.constraints;
return g instanceof a?(d=c(d),d&&(h.locations=[d],h.restrict_value=!0)):(a.each(g,function(a,b){f=f.concat(b.locations)}),f.length&&(h.locations=f,h.restrict_value=e.options.restrict_value)),h},getFirstConstraintLabel:function(){var b=this,c=a.isPlainObject(b.constraints)&&Object.keys(b.constraints)[0];return c?b.constraints[c].label:""},unbindFromParent:function(){var b=this.constraints;b instanceof a&&b.off("."+this.uniqueId)},onParentSelectionChanged:function(){this.clear()},onParentDispose:function(){this.unbindFromParent()},shareWithParent:function(b){var c,e=this.constraints instanceof a&&this.constraints.suggestions();e&&e.type===this.type&&!d(b,e)&&(e.shareWithParent(b),c=e.copyBoundedData(b.data,e.bounds.own),c=e.type.composeValue(c),c&&e.setSuggestion({value:c,data:e.copyBoundedData(b.data,e.bounds.all)}))}};a.extend(k,e),a.extend(b.prototype,g),"GET"!=m.getDefaultType()&&l.on("initialize",g.createConstraints).on("setOptions",g.setupConstraints).on("fixPosition",g.setConstraintsPosition).on("requestParams",g.constructConstraintsParams).on("dispose",g.unbindFromParent)}(),function(){var c={proceedQuery:function(a){var b=this;a.length>=b.options.minChars?b.updateSuggestions(a):b.hide()},selectCurrentValue:function(b){var c=this,d=a.Deferred();return c.inputPhase.resolve(),c.dataPhase.done(function(){d.resolve(c.doSelectCurrentValue(b))}),d},doSelectCurrentValue:function(b){var c,d=this,e=d.selectedIndex,f=b&&b.trim;return-1===e&&(c=d.el.val(),f&&(c=a.trim(c)),e=d.findSuggestionIndex(c)),d.select(e,b),e},select:function(b,c){var d=this,e=d.suggestions[b],f=c&&c.continueSelecting,g=c&&c.noSpace;return e?void d.enrichSuggestion(e,c).done(function(c,e){var h,i=d.type.isDataComplete.call(d,c),j=d.selection;d.type.alwaysContinueSelecting&&(f=!0),i&&(f=!1),e&&(d.suggestions[b]=c),d.checkValueBounds(c),a.isFunction(d.options.formatSelected)&&(h=d.options.formatSelected.call(d,c)),d.currentValue="string"==typeof h&&h.length?h:c.value,g||i||(d.currentValue+=" "),d.el.val(d.currentValue),d.selection=c,d.areSuggestionsSame(c,j)||d.trigger("Select",c),d.onSelectComplete(f),d.shareWithParent(c)}):(f||d.selection||d.triggerOnSelectNothing(),void d.onSelectComplete(f))},onSelectComplete:function(a){var b=this;a?(b.selectedIndex=-1,b.updateSuggestions(b.currentValue)):b.hide()},triggerOnSelectNothing:function(){this.trigger("SelectNothing",this.currentValue)},trigger:function(b){var c=this,d=m.slice(arguments,1),e=c.options["on"+b];a.isFunction(e)&&e.apply(c.element,d),c.el.trigger.apply(c.el,["suggestions-"+b.toLowerCase()].concat(d))}};a.extend(b.prototype,c)}(),function(){var b={bounds:null},c={setupBounds:function(){this.bounds={from:null,to:null}},setBoundsOptions:function(){var b,c,d=this,e=d.type.boundsAvailable,f=a.trim(d.options.bounds).split("-"),g=f[0],h=f[f.length-1],i=[],j=[];-1===a.inArray(g,e)&&(g=null),c=a.inArray(h,e),(-1===c||c===e.length-1)&&(h=null),(g||h)&&(b=!g,a.each(e,function(a,c){return c==g&&(b=!0),j.push(c),b&&i.push(c),c==h?!1:void 0})),d.bounds.from=g,d.bounds.to=h,d.bounds.all=j,d.bounds.own=i},constructBoundsParams:function(){var a=this,b={};return a.bounds.from&&(b.from_bound={value:a.bounds.from}),a.bounds.to&&(b.to_bound={value:a.bounds.to}),b},checkValueBounds:function(b){var c=this,d=c.copyBoundedData(b.data,c.bounds.own);!a.isEmptyObject(d)&&c.type.composeValue&&(d=c.type.composeValue(d),d&&(b.value=d))},copyBoundedData:function(b,c){var d={},e=this.type.boundsFields;return e&&a.each(c,function(c,f){var g=e[f];g&&a.each(g,function(a,c){null!=b[c]&&(d[c]=b[c])})}),d}};a.extend(k,b),a.extend(a.Suggestions.prototype,c),l.on("initialize",c.setupBounds).on("setOptions",c.setBoundsOptions).on("requestParams",c.constructBoundsParams)}(),a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(f):this.each(function(){var e=a(this),g=e.data(f);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),e.data(f,g))})}});